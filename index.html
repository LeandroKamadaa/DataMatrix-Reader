<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leitor de Data Matrix</title>
    <script src="https://unpkg.com/@zxing/library@0.20.0/umd/index.min.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            font-family: sans-serif;
            background-color: #f0f0f0;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        #video-container {
            position: relative;
            width: 80%;
            max-width: 640px;
            border: 2px solid #333;
            background-color: #000;
        }

        #camera-feed {
            width: 100%;
            height: auto;
            transform: scaleX(-1); /* Espelha horizontalmente */
        }
        
        #datamatrix-value {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            background-color: #fff;
            color: #444;
            font-size: 1.2em;
            text-align: center;
            min-height: 40px;
            width: 80%;
            max-width: 640px;
            word-wrap: break-word; /* Garante que o texto se quebre se for muito longo */
        }
    </style>
</head>
<body>

    <h1>Leitor de Data Matrix</h1>
    
    <div id="video-container">
        <video id="camera-feed" autoplay playsinline></video>
    </div>

    <h2>Valor do Data Matrix:</h2>
    <div id="datamatrix-value">Nenhum código detectado.</div>

    <script>
        // O elemento de vídeo onde a câmera será exibida
        const videoElement = document.getElementById('camera-feed');
        // O elemento onde o valor do Data Matrix será exibido
        const resultElement = document.getElementById('datamatrix-value');

        // Cria uma nova instância da classe BarcodeScanner da biblioteca ZXing-JS
        const codeReader = new ZXing.BrowserMultiFormatReader();

        // Obtém o stream da câmera e inicia a decodificação
        codeReader.getVideoInputDevices()
            .then((videoInputDevices) => {
                // Seleciona a primeira câmera disponível
                const firstDeviceId = videoInputDevices[0].deviceId;

                // Inicia o leitor de código de barras a partir do stream da câmera
                codeReader.decodeFromVideoDevice(firstDeviceId, 'camera-feed', (result, err) => {
                    if (result) {
                        // Se um código foi detectado, atualiza o elemento HTML com o valor
                        resultElement.textContent = result.text;
                        console.log('Código Data Matrix detectado:', result.text);

                        // Opcional: Para parar de escanear após a primeira leitura bem-sucedida
                        // codeReader.reset(); 
                    }
                    if (err && !(err instanceof ZXing.NotFoundException)) {
                        // Captura outros erros, mas ignora o erro NotFoundException
                        // que é esperado quando nenhum código é encontrado
                        console.error(err);
                    }
                });
            })
            .catch((err) => {
                // Lida com erros se não houver câmeras disponíveis ou a permissão for negada
                console.error('Erro ao acessar a câmera:', err);
                resultElement.textContent = 'Erro ao acessar a câmera. Verifique se a permissão foi concedida.';
            });
    </script>

</body>
</html>